var fs = require('fs')
var path = require('path')
var Dinero = require('./index')
var moment = require('moment')

var client = new Dinero({
  clientId: 'dineroappios',
  clientSecret: 'VYDaSKI3jGw3eiQmbbTTNnoa9kmRLeu16Pb0Q1NW3Mc'
})

var apiKey = 'a01d5a7974c04ec295707d44ad8dd1f9'
var orgId = 22909

client.auth(apiKey, apiKey).then((auth) => {
  console.log('.. authenticated!')

  var createFile = client.files.create(orgId, {
    image: fs.createReadStream(path.join(__dirname, '/test1pdf'))
  }, {
    multipart: true
  })

  createFile.then((body) => {
    console.log('... file uploaded, id=', body.FileGuid)
    return client.vouchers.purchase.create(orgId, {
      FileGuid: body.FileGuid,
      Notes: 'Uploaded from email',
      VoucherDate: moment(new Date()).format('YYYY-DD-MM')
    })
  }).then((body) => {
    console.log('.... voucher created, id=', body.VoucherGuid)
    console.log('DONE')
  }).catch((err) => {
    console.log('error', err)
  })
})
